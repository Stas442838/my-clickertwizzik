<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Casino Pro</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root {
            --main-color: #ff4b1f;
            --bg-color: #1a1a1a;
            --card-bg: #2d2d2d;
        }
        
        body {
            background-color: var(--bg-color);
            color: white;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            margin: 0;
            overflow: hidden;
            user-select: none;
        }

        /* –ö–Ω–æ–ø–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫ (—à–µ—Å—Ç–µ—Ä–µ–Ω–∫–∞) */
        .settings-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            font-size: 24px;
            cursor: pointer;
            background: none;
            border: none;
            color: #777;
            transition: color 0.3s;
        }
        .settings-btn:hover { color: white; }

        .balance-container {
            background: var(--card-bg);
            padding: 15px 30px;
            border-radius: 20px;
            margin-bottom: 40px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.5);
            font-size: 24px;
            border: 1px solid #444;
        }

        .slots {
            display: flex;
            gap: 15px;
            margin-bottom: 40px;
            perspective: 1000px;
        }

        .reel {
            width: 85px;
            height: 110px;
            background: linear-gradient(to bottom, #eee, #fff, #eee);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 45px;
            color: #333;
            border: 4px solid #ffd700;
            box-shadow: inset 0 0 15px rgba(0,0,0,0.3), 0 10px 20px rgba(0,0,0,0.5);
            transition: transform 0.2s;
        }

        button.spin-btn {
            background: linear-gradient(45deg, #ff4b1f, #ff9068);
            border: none;
            padding: 18px 50px;
            color: white;
            font-size: 22px;
            border-radius: 50px;
            cursor: pointer;
            font-weight: 800;
            box-shadow: 0 5px 25px rgba(255, 75, 31, 0.5);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        button.spin-btn:active { transform: scale(0.95); }
        button:disabled { background: #444; box-shadow: none; cursor: not-allowed; }

        #message {
            margin-top: 25px;
            height: 25px;
            color: #ffd700;
            font-weight: bold;
            font-size: 18px;
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.3);
        }

        /* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –Ω–∞—Å—Ç—Ä–æ–µ–∫ */
        .modal {
            display: none;
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 100;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background: #333;
            padding: 30px;
            border-radius: 20px;
            width: 80%;
            max-width: 300px;
            text-align: left;
            border: 1px solid #555;
        }

        .modal h2 { margin-top: 0; text-align: center; color: #ffd700; }

        .setting-item {
            margin: 20px 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        /* –°–≤–∏—Ç—á (–ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å) */
        .switch {
            position: relative; display: inline-block; width: 50px; height: 24px;
        }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider {
            position: absolute; cursor: pointer;
            top: 0; left: 0; right: 0; bottom: 0;
            background-color: #555; transition: .4s; border-radius: 34px;
        }
        .slider:before {
            position: absolute; content: "";
            height: 16px; width: 16px; left: 4px; bottom: 4px;
            background-color: white; transition: .4s; border-radius: 50%;
        }
        input:checked + .slider { background-color: #ff4b1f; }
        input:checked + .slider:before { transform: translateX(26px); }

        /* –ü–æ–ª–µ –≤–≤–æ–¥–∞ –ø—Ä–æ–º–æ–∫–æ–¥–∞ */
        .promo-input {
            width: 100%;
            padding: 10px;
            border-radius: 8px;
            border: 1px solid #555;
            background: #222;
            color: white;
            margin-top: 5px;
            box-sizing: border-box;
        }
        .apply-btn {
            width: 100%;
            margin-top: 10px;
            padding: 10px;
            background: #444;
            border: none;
            color: white;
            border-radius: 8px;
            cursor: pointer;
        }
        .close-modal {
            margin-top: 20px;
            width: 100%;
            padding: 10px;
            background: transparent;
            border: 1px solid #777;
            color: #bbb;
            border-radius: 8px;
        }
    </style>
</head>
<body>

    <button class="settings-btn" onclick="openSettings()">‚öôÔ∏è</button>

    <div id="settingsModal" class="modal">
        <div class="modal-content">
            <h2>–ù–∞—Å—Ç—Ä–æ–π–∫–∏</h2>
            
            <div class="setting-item">
                <span>üì≥ –í–∏–±—Ä–∞—Ü–∏—è</span>
                <label class="switch">
                    <input type="checkbox" id="vibrateToggle" checked onchange="saveSettings()">
                    <span class="slider"></span>
                </label>
            </div>

            <div class="setting-item">
                <span>üöÄ –¢—É—Ä–±–æ —Ä–µ–∂–∏–º</span>
                <label class="switch">
                    <input type="checkbox" id="turboToggle" onchange="saveSettings()">
                    <span class="slider"></span>
                </label>
            </div>

            <div style="margin-top: 20px;">
                <label>üéÅ –ü—Ä–æ–º–æ–∫–æ–¥:</label>
                <input type="text" id="promoInput" class="promo-input" placeholder="–í–≤–µ–¥–∏ –∫–æ–¥...">
                <button class="apply-btn" onclick="checkPromo()">–ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å</button>
            </div>

            <button class="close-modal" onclick="closeSettings()">–ó–∞–∫—Ä—ã—Ç—å</button>
        </div>
    </div>

    <div class="balance-container">
        <span id="balance">1000</span> $
    </div>

    <div class="slots">
        <div class="reel" id="r1">7Ô∏è‚É£</div>
        <div class="reel" id="r2">7Ô∏è‚É£</div>
        <div class="reel" id="r3">7Ô∏è‚É£</div>
    </div>

    <button id="spinBtn" class="spin-btn" onclick="spin()">–ö–†–£–¢–ò–¢–¨ (50$)</button>
    <div id="message">–£–¥–∞—á–∏!</div>

    <script>
        let tg = window.Telegram.WebApp;
        tg.expand();

        // –î–∞–Ω–Ω—ã–µ –∏–≥—Ä—ã
        const symbols = ['üçí', 'üçã', 'üçá', 'üíé', '7Ô∏è‚É£', 'üîî'];
        const cost = 50;
        
        // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ –ø–∞–º—è—Ç–∏ —Ç–µ–ª–µ—Ñ–æ–Ω–∞
        let balance = parseInt(localStorage.getItem('casino_balance')) || 1000;
        let isVibration = localStorage.getItem('setting_vibration') !== 'false'; // –ü–æ –¥–µ—Ñ–æ–ª—Ç—É true
        let isTurbo = localStorage.getItem('setting_turbo') === 'true';
        let usedPromos = JSON.parse(localStorage.getItem('used_promos')) || [];

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        updateBalance();
        document.getElementById('vibrateToggle').checked = isVibration;
        document.getElementById('turboToggle').checked = isTurbo;

        // --- –õ–æ–≥–∏–∫–∞ –∏–≥—Ä—ã ---

        function spin() {
            if (balance < cost) {
                showMessage("‚ùå –ù–µ —Ö–≤–∞—Ç–∞–µ—Ç –¥–µ–Ω–µ–≥!", "red");
                haptic('error');
                return;
            }

            balance -= cost;
            updateBalance();
            showMessage("...", "white");
            
            let btn = document.getElementById('spinBtn');
            btn.disabled = true;
            btn.style.transform = "scale(0.95)";

            let spins = 0;
            // –°–∫–æ—Ä–æ—Å—Ç—å: –µ—Å–ª–∏ —Ç—É—Ä–±–æ - 50–º—Å, –∏–Ω–∞—á–µ 100–º—Å. –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–æ–∫—Ä—É—Ç–æ–≤ —Ç–æ–∂–µ –º–µ–Ω—è–µ–º.
            let speed = isTurbo ? 50 : 100; 
            let maxSpins = isTurbo ? 5 : 15;

            let interval = setInterval(() => {
                document.getElementById('r1').innerText = getRandomSymbol();
                document.getElementById('r2').innerText = getRandomSymbol();
                document.getElementById('r3').innerText = getRandomSymbol();
                
                if(isVibration && spins % 2 === 0) tg.HapticFeedback.selectionChanged();
                
                spins++;
                if(spins > maxSpins) {
                    clearInterval(interval);
                    checkWin();
                    btn.disabled = false;
                    btn.style.transform = "scale(1)";
                }
            }, speed);
        }

        function getRandomSymbol() {
            return symbols[Math.floor(Math.random() * symbols.length)];
        }

        function checkWin() {
            let r1 = document.getElementById('r1').innerText;
            let r2 = document.getElementById('r2').innerText;
            let r3 = document.getElementById('r3').innerText;

            let win = 0;

            // –õ–æ–≥–∏–∫–∞ –ø–æ–±–µ–¥
            if (r1 === r2 && r2 === r3) {
                if(r1 === '7Ô∏è‚É£') win = 5000; // –î–∂–µ–∫–ø–æ—Ç
                else if(r1 === 'üíé') win = 1000;
                else if(r1 === 'üîî') win = 500;
                else win = 200;
            } 
            // –£—Ç–µ—à–∏—Ç–µ–ª—å–Ω—ã–π –ø—Ä–∏–∑ –∑–∞ –¥–≤–µ —Å–µ–º–µ—Ä–∫–∏
            else if ((r1 === '7Ô∏è‚É£' && r2 === '7Ô∏è‚É£') || (r2 === '7Ô∏è‚É£' && r3 === '7Ô∏è‚É£')) {
                win = 100;
            }

            if (win > 0) {
                balance += win;
                showMessage(`üéâ –í–´–ò–ì–†–´–®: +${win}$`, "#00ff00");
                haptic('success');
            } else {
                showMessage("–ü—É—Å—Ç–æ...", "#777");
            }
            updateBalance();
        }

        function updateBalance() {
            document.getElementById('balance').innerText = balance;
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –±–∞–ª–∞–Ω—Å –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∏–∑–º–µ–Ω–µ–Ω–∏–∏
            localStorage.setItem('casino_balance', balance);
        }

        function showMessage(text, color) {
            let msg = document.getElementById('message');
            msg.innerText = text;
            msg.style.color = color;
        }

        function haptic(type) {
            if(!isVibration) return;
            tg.HapticFeedback.notificationOccurred(type);
        }

        // --- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∏ –ü—Ä–æ–º–æ–∫–æ–¥—ã ---

        function openSettings() {
            document.getElementById('settingsModal').style.display = 'flex';
        }

        function closeSettings() {
            document.getElementById('settingsModal').style.display = 'none';
        }

        function saveSettings() {
            isVibration = document.getElementById('vibrateToggle').checked;
            isTurbo = document.getElementById('turboToggle').checked;
            
            localStorage.setItem('setting_vibration', isVibration);
            localStorage.setItem('setting_turbo', isTurbo);
        }

        function checkPromo() {
            let input = document.getElementById('promoInput');
            let code = input.value.trim().toUpperCase();
            
            if(usedPromos.includes(code)) {
                alert("–¢—ã —É–∂–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª —ç—Ç–æ—Ç –∫–æ–¥!");
                return;
            }

            // –°–ø–∏—Å–æ–∫ –∫–æ–¥–æ–≤
            if(code === "START") {
                addPromoBonus(500, code);
            } else if (code === "GEMINI") {
                addPromoBonus(1000, code);
            } else if (code === "RICH") {
                addPromoBonus(5000, code);
            } else {
                alert("–ù–µ–≤–µ—Ä–Ω—ã–π –∫–æ–¥ üò¢");
            }
            
            input.value = "";
        }

        function addPromoBonus(amount, code) {
            balance += amount;
            usedPromos.push(code);
            localStorage.setItem('used_promos', JSON.stringify(usedPromos));
            updateBalance();
            alert(`–ü—Ä–æ–º–æ–∫–æ–¥ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω! +${amount}$`);
            haptic('success');
            closeSettings();
        }
    </script>
</body>
</html>
